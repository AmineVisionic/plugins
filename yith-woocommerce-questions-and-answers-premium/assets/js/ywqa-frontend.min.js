jQuery(document).ready(function(a){function e(){ywqa.recaptcha&&jQuery("#ywqa-g-recaptcha:empty").length&&"undefined"!=typeof grecaptcha&&(i=grecaptcha.render("ywqa-g-recaptcha",{sitekey:ywqa.recaptcha_sitekey}))}function t(t,n){var o={action:"show_question_list",product_id:a("#ywqa-questions-and-answers").data("product-id"),answered:t,show_all:n},s=a("#ywqa-questions-and-answers");s.length&&(s.block({message:null,overlayCSS:{background:"#fff url("+ywqa.loader+") no-repeat center",opacity:.6}}),a.post(ywqa.ajax_url,o,function(t){-1==t.code?top.location.replace(t.value):1==t.code&&a("#ywqa-questions-and-answers").replaceWith(t.items),e(),n&&a("#show-all-questions").remove(),s.unblock()}))}function n(e,t){a("<span class='operation-error'>"+t+"</span>").insertAfter(a(e))}function o(e){var t=a("#ywqa_user_content"),o=a('input[name="ywqa-guest-name"]'),s=a('input[name="ywqa-guest-email"]'),i=0;return 0==t.val().length&&(n(t,ywqa.content_is_empty),i=1),o.length&&ywqa.mandatory_guest_data&&!o.val().length&&(n(o,ywqa.guest_name_message),i=1),s.length&&(ywqa.mandatory_guest_data&&!s.val().length?(n(s,ywqa.guest_email_message),i=1):s.val().length&&(/^[A-Z0-9._%+-]+@([A-Z0-9-]+\.)+[A-Z]{2,5}$/i.test(s.val())||(n(s,ywqa.guest_email_message),i=1))),0==i}function s(t,n){var o={action:"goto_question",discussion_id:t,order:void 0!==n?n:"default"},s=a("#ywqa-questions-and-answers");s.block({message:null,overlayCSS:{background:"#fff url("+ywqa.loader+") no-repeat center",opacity:.6}}),a.post(ywqa.ajax_url,o,function(t){-1==t.code?top.location.replace(t.value):1==t.code&&a("#ywqa-questions-and-answers").replaceWith(t.items),e(),s.unblock()})}var i=-1;e(),a(document).on("vc_js",function(){e()}),a("div.woocommerce-tabs ul.tabs li.questions_tab").on("click",function(a){a.preventDefault(),t(!1,!1)}),1==ywqa.goto_questions_tab&&a(document).find(".woocommerce-tabs ul.tabs li.questions_tab a")[0].click(),a(document).on("click","a.vote-question",function(e){e.preventDefault();a(this);var t={action:"vote_question",discussion_id:a(this).attr("data-discussion-id"),discussion_vote:a(this).attr("data-discussion-vote"),_wpnonce:ywqa.nonce_value,return_path:window.location.href},n=a(this).closest("div.question-votes");n.block({message:null,overlayCSS:{background:"#fff url("+ywqa.loader+") no-repeat center",opacity:.6}}),a.post(ywqa.ajax_url,t,function(a){-1==a.code?top.location.replace(a.value):1==a.code&&n.children("span.question-votes-count").text(a.value),n.unblock()})}),a(document).on("click","a.answer-helpful, a.answer-not-helpful",function(e){e.preventDefault();a(this);var t={action:"vote_answer",discussion_id:a(this).attr("data-discussion-id"),discussion_vote:a(this).attr("data-discussion-vote"),_wpnonce:ywqa.nonce_value,return_path:window.location.href},n=a(this).closest("div.answer-helpful");n.block({message:null,overlayCSS:{background:"#fff url("+ywqa.loader+") no-repeat center",opacity:.6}}),a.post(ywqa.ajax_url,t,function(a){-1==a.code?top.location.replace(a.value):1==a.code&&n.children("span.answer-stat-text").text(a.value),n.unblock()})}),a(document).on("click","a.report-answer-abuse",function(e){e.preventDefault();a(this);var t={action:"report_answer_abuse",discussion_id:a(this).attr("data-discussion-id"),discussion_vote:1,_wpnonce:ywqa.nonce_value,return_path:window.location.href},n=a(this).closest("div.answer-abuse");n.block({message:null,overlayCSS:{background:"#fff url("+ywqa.loader+") no-repeat center",opacity:.6}}),a.post(ywqa.ajax_url,t,function(a){-1==a.code?top.location.replace(a.value):1==a.code&&n.empty().html('<span class="thanks">'+ywqa.abuse_response+"</span>"),n.unblock()})}),a(document).on("click","a.read-more",function(e){e.preventDefault();var t={action:"get_full_content",discussion_id:a(this).attr("data-discussion-id")},n=a(this).closest("div.answer-content");n.block({message:null,overlayCSS:{background:"#fff url("+ywqa.loader+") no-repeat center",opacity:.6}}),a.post(ywqa.ajax_url,t,function(a){1==a.code&&(n.children(".read-more").remove(),text=a.value.replace(/(?:\r\n|\r|\n)/g,"<br />"),n.children("span.answer").empty().html(text)),n.unblock()})}),a(document).on("click","a.goto-page",function(e){if(e.preventDefault(),a(this).attr("data-ywqa-product-id").length){var t="get_questions",n=a(this).closest("div#ywqa_question_list");a("ol.item-navigation.answers").length&&(t="get_answers",n=a(this).closest("div#ywqa_answer_list"));var o={action:t,product_id:a(this).attr("data-ywqa-product-id"),order:a(this).attr("data-ywqa-order"),question_id:a(this).attr("data-ywqa-question-id"),page:a(this).attr("data-ywqa-page")};n.block({message:null,overlayCSS:{background:"#fff url("+ywqa.loader+") no-repeat center",opacity:.6}}),a.post(ywqa.ajax_url,o,function(a){1==a.code&&(n.find("ol.ywqa-items-list").empty().append(a.items),n.find("ol.item-navigation").empty().append(a.pagination)),n.unblock()})}}),a(document).on("click","input#ywqa-submit-question",function(t){t.preventDefault(),a("span.operation-error").remove(),a("span.operation-completed").remove();try{if(ywqa.recaptcha&&(null==grecaptcha||!grecaptcha.getResponse(i)))return void a("div.ywqa-ask-question").prepend("<span class='operation-error'>"+ywqa.recaptcha_not_valid+"</span>")}catch(t){return void a("div.ywqa-ask-question").prepend("<span class='operation-error'>"+ywqa.recaptcha_not_valid+"</span>")}if(o()){var n={action:"submit_question",text:a("#ywqa_user_content").val(),subscribe:a("#ywqa-notify-user").length?a("#ywqa-notify-user").prop("checked"):0,product_id:a("#ywqa-questions-and-answers").data("product-id"),recaptcha:a('div#ywqa-g-recaptcha TextArea[name="g-recaptcha-response"]').val()};a("#ywqa-guest-name").length&&(n.name=a("input[name='ywqa-guest-name']").val()),a("#ywqa-guest-email").length&&(n.email=a("input[name='ywqa-guest-email']").val());var s=a("div.ywqa-ask-question");s.block({message:null,overlayCSS:{background:"#fff url("+ywqa.loader+") no-repeat center",opacity:.6}}),a.post(ywqa.ajax_url,n,function(t){1==t.code?(a("#ywqa-questions-and-answers").replaceWith(t.items),e(),1==t.waiting_approval&&a("div#submit_answer").append("<span class='operation-completed'>"+t.message+"</span>")):-1==t.code?a("div#ask_question").empty().append("<span class='operation-completed'>"+t.message+"</span>"):a("div#ask_question").append("<span class='operation-error'>"+ywqa.discussion_error+"</span>"),s.unblock()})}}),a(document).on("click","input#ywqa-submit-answer",function(t){t.preventDefault(),a("span.operation-error").remove(),a("span.operation-completed").remove();try{if(ywqa.recaptcha&&(null==grecaptcha||!grecaptcha.getResponse(i)))return void a("div#submit_answer").prepend("<span class='operation-error'>"+ywqa.recaptcha_not_valid+"</span>")}catch(t){return void a("div#submit_answer").prepend("<span class='operation-error'>"+ywqa.recaptcha_not_valid+"</span>")}if(o()){var n={action:"submit_answer",answer_content:a("#ywqa_user_content").val(),product_id:a("#ywqa-questions-and-answers").data("product-id"),question_id:a("input[name='ywqa_question_id']").val(),recaptcha:a('div#ywqa-g-recaptcha TextArea[name="g-recaptcha-response"]').val()};a("#ywqa-guest-name").length&&(n.name=a("input[name='ywqa-guest-name']").val()),a("#ywqa-guest-email").length&&(n.email=a("input[name='ywqa-guest-email']").val());var s=a("div.ywqa-send-answer");s.block({message:null,overlayCSS:{background:"#fff url("+ywqa.loader+") no-repeat center",opacity:.6}}),a.post(ywqa.ajax_url,n,function(t){1==t.code?(a("#ywqa-questions-and-answers").replaceWith(t.items),1==t.waiting_approval&&a("div#submit_answer").append("<span class='operation-completed'>"+t.message+"</span>")):-1==t.code?a("div#submit_answer").append("<span class='operation-error'>"+t.message+"</span>"):a("div#submit_answer").append("<span class='operation-error'>"+ywqa.discussion_error+"</span>"),e(),s.unblock()})}}),a(document).on("click","a.ywqa-question-order",function(e){e.preventDefault(),s(a("input[name='ywqa_question_id']").val(),a(this).data("order"))}),a(document).on("click","a.goto-question",function(e){e.preventDefault(),s(a(this).attr("data-discussion-id"))}),a(document).on("click","a.back-to-product",function(a){a.preventDefault(),t(!1,!1)}),a(document).on("input",'input[name="ywqa-search-text"]',function(e){e.preventDefault();var t={action:"filter_content",product_id:a("#ywqa-questions-and-answers").data("product-id"),text:a(this).val()},n=a(this).closest(".ywqa-container").find(".ywqa-content");n.block({message:null,overlayCSS:{background:"#fff url("+ywqa.loader+") no-repeat center",opacity:.6}}),a.post(ywqa.ajax_url,t,function(a){1==a.code&&n.replaceWith(a.items),n.unblock()})}),a(document).on("click","a.show-questions",function(a){a.preventDefault(),t(!1,!0)})});