jQuery(document).ready(function(e){var t=function(){return e(".shipping_method").length>1?e(".shipping_method:checked").val():e(".shipping_method").val()},a=function(t){e(".ywcdd_shipping_date").val(t)},d=function(t){var a=e(".ywcdd_timeslot_content"),d=e("#ywcdd_timeslot"),i=e(".ywcdd_timeslot_info"),n=(e(".form-row-slot"),e(".ywcdd_timeslot_av"));d.find("option").not("[value='']").remove(),e.isEmptyObject(t)?(n.val("no"),a.hide(),i.hide()):(e.each(t,function(t,a){d.append(e("<option></option>").attr("value",t).html(a))}),a.show(),i.show(),n.val("yes")),d.val("").trigger("change")},i=function(t){var i=e(".ywcdd_timeslot_content");if(""!=t){var n=e("#ywcdd_carrier").val(),o=e(".form-row-slot"),s=e("#ywcdd_process_method");data={ywcdd_carrier_id:n,ywcdd_date_selected:t,ywcdd_process_method:s.length?s.val():"",action:ywcdd_params.actions.update_timeslot},i.show(),o.hide(),_.block(c),e.ajax({type:"POST",url:ywcdd_params.ajax_url,data:data,dataType:"json",success:function(e){var t=e.available_timeslot;d(t),a(e.shipping_date),_.unblock(),r()}})}else i.hide()},n=function(t){if(date_picker_content=e(".ywcdd_datepicker_content"),datepicker=e("#ywcdd_datepicker"),date_picker_info_content=e(".ywcdd_info_content"),""!=t){var i=e("#ywcdd_process_method").val(),n=date_picker_info_content.find(".ywcdd_message");data={ywcdd_carrier_id:t,ywcdd_process_id:i,action:ywcdd_params.actions.update_datepicker},date_picker_content.hide(),date_picker_info_content.hide(),_.block(c),e.ajax({type:"POST",url:ywcdd_params.ajax_url,data:data,dataType:"json",success:function(e){if(void 0!==e.available_days){var t=e.available_days;datepicker.data("available_days",t);var i=0,o=0;t.length>0&&(i=t[0],o=t[t.length-1]),datepicker.datepicker("option","minDate",i),datepicker.datepicker("option","maxDate",o),datepicker.datepicker("setDate",i),d(e.available_timeslot),a(e.shipping_date),n.html(e.message),date_picker_info_content.show(),_.unblock(),r()}}})}else{date_picker_info_content.hide(),date_picker_content.hide(),datepicker.val("");var s=e("#ywcdd_timeslot");s.find("option").not("[value='']").remove(),s.val("").trigger("change")}o()},o=function(){var t=e(".ywcdd_timeslot_content"),a=e(".form-row-slot");t.hide(),a.hide()},c={message:null,overlayCSS:{background:"#fff",opacity:.6},ignoreIfBlocked:!0},r=function(){if("yes"==ywcdd_params.open_datepicker){var t=(a=e(document).find(".ywcdd_info_content")).parent().find(".ywcdd_datepicker_content");a.hide(),t.show("slow");var a,d=(a=e(document).find(".ywcdd_timeslot_info")).parent().find(".form-row-slot");a.hide(),d.show("slow")}},_=e("div.ywcdd_select_delivery_date_content"),s=t();e(document).on("init-delivery-fields",function(t){var a=e("#ywcdd_datepicker"),d=e("#ywcdd_carrier");if(a.length){var o=a.data("available_days");a.datepicker({dateFormat:ywcdd_params.dateformat,numberOfMonths:1*ywcdd_params.numberOfMonths,beforeShow:function(t,a){e("#ui-datepicker-div").removeClass("yith_datepicker"),e("#ui-datepicker-div").addClass("yith_datepicker"),setTimeout(function(){e("#ui-datepicker-div").show()},0)},beforeShowDay:function(t){var a=e(this).data("available_days"),d=e.datepicker.formatDate("yy-mm-dd",t);return[-1!=a.indexOf(d)]},onClose:function(t,d){var n=e(this).data("available_days");void 0!==n&&-1==n.indexOf(t)?(alert("Error: the date "+t+" isn't available"),a.datepicker("setDate",n[0])):(i(t),e("#ui-datepicker-div").hide(),e("#ui-datepicker-div").unwrap())}}),void 0!==o&&o.length>0&&(min=o[0],max=o[o.length-1],a.datepicker("option","minDate",min),a.datepicker("option","maxDate",max),a.datepicker("setDate",min),i(min))}if(d.length&&(d.on("change",function(t){var a=e(this).val();n(a)}),d.is("input"))){var c=d.val();-1!=c&&n(c)}}).trigger("init-delivery-fields"),e("form.checkout").on("change","#ywcdd_timeslot",function(t){e("body").trigger("update_checkout")}).on("click",".ywcdd_edit_date",function(t){t.preventDefault();var a=e(this).parents(".ywcdd_info_content"),d=a.parent().find(".ywcdd_datepicker_content");a.hide("slow"),d.show("slow")}).on("click",".ywcdd_show_timeslot",function(t){t.preventDefault();var a=e(this).parents(".ywcdd_timeslot_info"),d=a.parent().find(".form-row-slot");a.hide("slow"),d.show("slow")}),e("body").on("updated_checkout",function(a){var d=t(),i=e("#ywcdd_process_method");""!=d&&s!=d&&(data={ywcdd_update_carrier:"update_carrier",ywcdd_shipping_id:d,ywcdd_process_method:i.val(),action:ywcdd_params.actions.update_carrier_list},s=d,e.ajax({type:"POST",url:ywcdd_params.ajax_url,data:data,dataType:"json",success:function(t){t.update_delivery_form&&(e(".ywcdd_select_delivery_date_content").html(t.template),e("body").trigger("init-delivery-fields"))}}))})});